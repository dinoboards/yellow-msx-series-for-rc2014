SIO0BASE	EQU	$80		; SIO BASE PORT
; PORT MAPPINGS FOR THE STANDARD RC2014 SIO/2
RC_SIOA_CMD	EQU	SIO0BASE + 0	; CONTROL/STATUS PORT
RC_SIOA_DAT	EQU	SIO0BASE + 1	; DATA PORT
RC_SIOB_CMD	EQU	SIO0BASE + 2	; CONTROL/STATUS PORT
RC_SIOB_DAT	EQU	SIO0BASE + 3    ; DATA PORT


SIO_WR1VAL	EQU	$18		; WR1 VALUE FOR INT ON RECEIVED CHARS
SIO_RTSON	EQU	$EA
SIO_RTSOFF	EQU	$E8

RS_TRANSMIT_PENDING_MASK	EQU	$04	; BIT 2 OF SIO REGISTER 0

; THE CLOCK FREQUENCY SELECTED FOR THE 2ND CLOCK, TO IDENTIFIY THE CORRECT BAUD RATES FOR THE SIO/2 MODULE
; A CLOCK OF 307200 MAPS TO THREE SELECTABLE BAUD RATES OF (19200, 9600, 4800)
BUS_CLK		EQU	307200

BAUD_LOW	EQU	BUS_CLK / 64	; 4800
BAUD_MID	EQU	BUS_CLK / 32	; 9600
BAUD_HIGH	EQU	BUS_CLK / 16	; 19200

FOSSIL_BAUD_75		EQU	0
FOSSIL_BAUD_300		EQU	1
FOSSIL_BAUD_600		EQU	2
FOSSIL_BAUD_1200	EQU	3
FOSSIL_BAUD_2400	EQU	4
FOSSIL_BAUD_4800	EQU	5
FOSSIL_BAUD_9600	EQU	6
FOSSIL_BAUD_19200	EQU	7
FOSSIL_BAUD_38400	EQU	8
FOSSIL_BAUD_57600	EQU	9
FOSSIL_BAUD_115200	EQU	11

SIO_CLK_DIV_64		EQU	11000000B
SIO_CLK_DIV_32		EQU	10000000B
SIO_CLK_DIV_16		EQU	01000000B

SIO_BUFSZ	EQU	256

SIO_CHIP_RTS_C	MACRO	_RTS
	LD	A, 5
	OUT	(C), A
	LD	A, _RTS
	OUT	(C), A
	ENDM


SIO_CHIP_INIT_C:	MACRO	 _RTS
	; WR0: CHANNEL RESET (C)
	XOR	A
	OUT	(C), A
	LD	A, 018H
	OUT	(C), A

	; WR4: CLK BAUD PARITY STOP BIT
	LD	A, 4
	OUT	(C), A
	LD	A, SIO_CLK_DIV_64		; CLK DIV SETTINGS IN BIT 6 AND 7
	OR	00000100B			; 1 STOP BIT
	OUT	(C), A

	; WR1: INTERRUPT ON
	LD	A, 1
	OUT	(C), A
	LD	A, SIO_WR1VAL
	OUT	(C), A

	; WR2: IM2 VEC OFFSET
	LD	A, 2
	OUT	(C), A
	LD	A, 00H
	OUT	(C),A

	; WR3: 8 BIT RCV, CTS/DCD AUTO, RX ENABLE
	LD	A, 3
	OUT	(C), A
	LD	A, 0E1H
	OUT	(C), A

	; WR5: DTR, 8
	LD	A, 5
	OUT	(C), A
	LD	A, _RTS
	OUT	(C), A
	ENDM

