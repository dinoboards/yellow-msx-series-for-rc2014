
	include	embinc.asm

	STRUCT _USB_DEVICE_INFO
BASE:
DEVICE_ADDRESS			DB
INTERFACE_ID			DB
CONFIG_ID			DB
MAX_PACKET_SIZE			DB
DATA_BULK_IN_ENDPOINT_ID	DB
DATA_BULK_OUT_ENDPOINT_ID	DB
DATA_BULK_IN_ENDPOINT_TOGGLE	DB
DATA_BULK_OUT_ENDPOINT_TOGGLE	DB
	ENDS

	STRUCT _SEARCH_DEVICE_INFO
NUM_CONFIGS			DB
NUM_INTERFACES			DB
NUM_ENDPOINTS			DB
WANTED_CLASS			DB
WANTED_SUB_CLASS		DB
WANTED_PROTOCOL			DB
	ENDS

	STRUCT _HUB_DEVICE_INFO
HUB_PORTS			DB
HUB_PORT_STATUS			DS 4
	ENDS

	STRUCT _SCSI_DEVINFO
BASE:						; Offset to the base of the data structure
TAG			db
MAX_LUNS		db
BUFFER:    		ds	0x24 		; longest response (inquiry) we want to absorb during init
CSW:			ds	_SCSI_COMMAND_STATUS_WRAPPER
VENDORID:		ds	8 		;UINT8	VendorIdStr[8];				/* 08H */
			db	0
PRODUCTID:		ds	16 		;UINT8 ProductIdStr[16];			/* 10H */
			db	0
PRODUCTREV:		ds	8 		;UINT8	ProductRevStr[4];			/* 20H */
			db	0
	ENDS



	STRUCT WRKAREA
BASE:					; Offset to the base of the data structure
STATUS:			db 		; bit 0 = CH376s present, bit 1 = initialised, bit 2 = USB device present, bit 3 = USB device mounted, bit 5 = DSK changed, bit 7 = Flash disk present
MAX_DEVICE_ADDRESS:	db 	0
USB_DEVICE_INFO:	_USB_DEVICE_INFO
STORAGE_DEVICE_INFO:	_USB_DEVICE_INFO
SEARCH_DEVICE_INFO	_SEARCH_DEVICE_INFO
HUB_DEVICE_INFO		_HUB_DEVICE_INFO
SCSI_DEVICE_INFO:	_SCSI_DEVINFO
USB_DESCRIPTOR		ds 	140 	; ** memory area to hold the usb device+config descriptor of the current interrogated device
USB_DESCRIPTORS		ds	USB_DESCRIPTORS_END - USB_DESCRIPTORS_START ; **
NXT_DIRECT		ds	NXT_DIRECT_END - NXT_DIRECT_START
	ENDS

	STRUCT ST_WRKAREA
RD_CNT		DB	0	; COUNT OF SECTORS TO BE READ
INDX_LW		DB	1	; SECTOR TO BE READ
INDX_HI		DB	2	; SECTOR TO BE READ 	; MUST BE LESS THAN 65536
DEST_LW		DB	3	; SECTOR DESTINATION ADDRESS (LOW)
DEST_HI		DB	4	; (HIGH)
RD_CND_RQ	DB	5	; NUMBER OF SECTORS REQUESTED
PRESENT		DB	6	; BIT FIELD FOR DETECTED DEVICES (BIT 0 -> COMPACTFLASH/IDE, BIT 1-> MSX-MUSIC NOR FLASH)
USB		WRKAREA
	ENDS

	DISPLAY "WRKAREA bytes: ",/D,WRKAREA

_usb_host_init:		EQU		$5800	; entry point within cextens section
_usb_dev_info:		EQU  	        $5803
_usb_lun_info:		EQU		$5806