	include "../rc2014config.inc"

SIO0BASE	EQU	$80		; SIO BASE PORT
SIO0A_DAT	EQU	SIO0BASE + 1	; DATA PORT
SIO0A_CMD	EQU	SIO0BASE + 0	; CONTROL/STATUS PORT

SIO0B_CMD	EQU	SIO0BASE + 2	; DATA PORT
SIO0B_DAT	EQU	SIO0BASE + 3    ; CONTROL/STATUS PORT

CMD_CH		EQU	SIO0B_CMD
DAT_CH		EQU	SIO0B_DAT

SIO_WR1VAL	EQU	$18		; WR1 VALUE FOR INT ON RECEIVED CHARS
SIO_RTSON	EQU	$EA
SIO_RTSOFF	EQU	$E8

BAUD_LOW	EQU	BUS_CLK / 64	; 4800
BAUD_MID	EQU	BUS_CLK / 32	; 9600
BAUD_HIGH	EQU	BUS_CLK / 16	; 19200

FOSSIL_BAUD_75		EQU	0
FOSSIL_BAUD_300		EQU	1
FOSSIL_BAUD_600		EQU	2
FOSSIL_BAUD_1200	EQU	3
FOSSIL_BAUD_2400	EQU	4
FOSSIL_BAUD_4800	EQU	5
FOSSIL_BAUD_9600	EQU	6
FOSSIL_BAUD_19200	EQU	7
FOSSIL_BAUD_38400	EQU	8
FOSSIL_BAUD_57600	EQU	9
FOSSIL_BAUD_115200	EQU	11

SIO_CLK_DIV_64		EQU	11000000B
SIO_CLK_DIV_32		EQU	10000000B
SIO_CLK_DIV_16		EQU	01000000B

SIO_BUFSZ	EQU	256

SIO_CHIP_INIT:	MACRO	_CMD, _RTS
	; WR0: CHANNEL RESET _CMD
	XOR	A
	OUT	(_CMD), A
	LD	A, 018H
	OUT	(_CMD), A

	; WR4: CLK BAUD PARITY STOP BIT
	LD	A, 4
	OUT	(_CMD), A
	LD	A, (RS_SIO_CLK_DIV)		; CLK DIV SETTINGS IN BIT 6 AND 7
	OR	00000100B		; 1 STOP BIT
	OUT	(_CMD), A

	; WR1: INTERRUPT ON
	LD	A, 1
	OUT	(_CMD), A
	LD	A, SIO_WR1VAL
	OUT	(_CMD), A

	; WR2: IM2 VEC OFFSET
	LD	A, 2
	OUT	(_CMD), A
	LD	A, 00H
	OUT	(_CMD),A

	; WR3: 8 BIT RCV, CTS/DCD AUTO, RX ENABLE
	LD	A, 3
	OUT	(_CMD), A
	LD	A, 0E1H
	OUT	(_CMD), A

	; WR5: DTR, 8
	LD	A, 5
	OUT	(_CMD), A
	LD	A, _RTS
	OUT	(_CMD), A
	ENDM

SIO_OUT_CHR:	MACRO	chr
	LD 	A, chr		; REQUEST NEXT PACKET
	OUT	(DAT_CH), A	; send to port
	ENDM

SIO_OUT_A:	MACRO
	OUT	(DAT_CH), A	; send to port
	ENDM

SIO_CHIP_RTS:	MACRO	_CMD, _RTS
	LD	A, 5
	OUT	(_CMD), A
	LD	A, _RTS
	OUT	(_CMD), A
	ENDM
