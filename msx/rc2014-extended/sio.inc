SIO0BASE	EQU	$80		; SIO BASE PORT
SIO0A_DAT	EQU	SIO0BASE + 1	; DATA PORT
SIO0A_CMD	EQU	SIO0BASE + 0	; CONTROL/STATUS PORT

SIO0B_CMD	EQU	SIO0BASE + 2	; DATA PORT
SIO0B_DAT	EQU	SIO0BASE + 3    ; CONTROL/STATUS PORT

CMD_CH		EQU	SIO0B_CMD
DAT_CH		EQU	SIO0B_DAT

SIO_WR1VAL	EQU	$18		; WR1 VALUE FOR INT ON RECEIVED CHARS
SIO_RTSON	EQU	$EA
SIO_RTSOFF	EQU	$E8

BUS_CLK		EQU	307200
BAUD_LOW	EQU	307200 / 64	; 4800
BAUD_MID	EQU	307200 / 32	; 9600
BAUD_HIGH	EQU	307200 / 16	; 19200

SIO_CHIP_INIT:	macro	CMD, RTS
	; WR0: CHANNEL RESET CMD
	LD	A, 0
	OUT	(CMD), A
	LD	A, 018H
	OUT	(CMD), A

	; WR4: CLK BAUD PARITY STOP BIT
	LD	A, 4
	OUT	(CMD), A
	LD	A, (IX+RSC_SND_BAUD)	; CLK DIV SETTINGS IN BIT 6 AND 7
	OR	00000100B		; 1 STOP BIT
	OUT	(CMD), A

	; WR1: INTERRUPT ON
	LD	A, 1
	OUT	(CMD), A
	LD	A, SIO_WR1VAL
	OUT	(CMD), A

	; WR2: IM2 VEC OFFSET
	LD	A, 2
	OUT	(CMD), A
	LD	A, 00H
	OUT	(CMD),A

	; WR3: 8 BIT RCV, CTS/DCD AUTO, RX ENABLE
	LD	A, 3
	OUT	(CMD), A
	LD	A, 0E1H
	OUT	(CMD), A

	; WR5: DTR, 8
	LD	A, 5
	OUT	(CMD), A
	LD	A, RTS
	OUT	(CMD), A
	ENDM

SIO_OUT_CHR:	macro	chr
	LD 	A, chr		; REQUEST NEXT PACKET
	OUT	(DAT_CH), A	; send to port
	endm

SIO_OUT_A:	macro
	OUT	(DAT_CH), A	; send to port
	endm

SIO_CHIP_RTS:	macro	CMD, RTS
	LD	A, 5
	OUT	(CMD), A
	LD	A, RTS
	OUT	(CMD), A
	endm
