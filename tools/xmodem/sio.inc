
S_BASE		EQU	$80		; SIO BASE PORT
S_DATP		EQU	S_BASE + 1	; DATA IN PORT
S_DATO		EQU	S_BASE + 1	; DATA OUT PORT
S_CTLP		EQU	S_BASE + 0	; CONTROL/STATUS PORT

SIO_WR1VAL	EQU	$18		; WR1 VALUE FOR INT ON RECEIVED CHARS
SIO_RTSON	EQU	$EA
SIO_RTSOFF	EQU	$E8
SIO_BUFSZ	EQU	245
SIO_BUF_HI	EQU	132

SIO_SNDBYT	MACRO
	OUT	(S_DATO), A	; send to port
	ENDM

SIO_RCVRDY	MACRO
	LD	A, (SIO_CNT)			; BUFFER UTILIZATION COUNT
	ENDM

SIO_INIT	MACRO
	; WR0: CHANNEL RESET CMD
	LD	A, 0
	OUT	(S_CTLP), A
	LD	A, 018H
	OUT	(S_CTLP),A

	; WR4: CLK BAUD PARITY STOP BIT
	LD	A, 4
	OUT	(S_CTLP), A
	LD	A, 0C4H
	OUT	(S_CTLP),A

	; WR1: INTERRUPT ON
	LD	A, 1
	OUT	(S_CTLP), A
	LD	A, SIO_WR1VAL
	OUT	(S_CTLP),A


	; WR2: IM2 VEC OFFSET
	LD	A, 2
	OUT	(S_CTLP), A
	LD	A, 00H
	OUT	(S_CTLP),A

	; WR3: 8 BIT RCV, CTS/DCD AUTO, RX ENABLE
	LD	A, 3
	OUT	(S_CTLP), A
	LD	A, 0E1H
	OUT	(S_CTLP),A

	; WR5: DTR, 8
	LD	A, 5
	OUT	(S_CTLP), A
	LD	A, SIO_RTSON
	OUT	(S_CTLP),A
	ENDM

DISABLE_SIO_INTERRUPTS		MACRO
	LD	A, 1
	OUT	(S_CTLP), A
	LD	A, 0
	OUT	(S_CTLP),A
	ENDM
